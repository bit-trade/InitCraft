# InitCraft v1.0.0-beta
[если ты не понимаешь английский - эта версия для тебя](README.md)

> ⚠️ Note: The utility currently outputs all messages **only in Russian**.

## Description

***InitCraft*** is an automation tool for initial setup of servers (VPS or physical hosts), written in Python. It allows system administrators to quickly prepare the environment by:

- generating or loading a configuration map,
- automatically editing system config files based on templates,
- creating backups,
- restoring from the most recent backups,
- converting text config files to JSON format,
- and choosing between CLI and TUI modes of operation.

Thanks to its flexible architecture, *InitCraft* can be used in both interactive mode (TUI via `curses`) and fully automated CLI mode with command-line arguments. It is suitable for routine DevOps automation, server configuration standardization, and speeding up new system deployments.

---

## Features

- [x] Load configuration map `env.json` from the default directory
- [x] Generate a new configuration map from scratch (`generate` mode)
- [x] Load a custom configuration map (`file` mode)
- [x] Manually populate the map (`inline` mode)
- [x] Automatically edit config files based on the loaded map
- [x] Create backups of all specified configuration files
- [x] Restore configurations from the most recent `.bak` files
- [x] Convert plain-text configurations to structured JSON files
- [x] CLI support: usable in scripts and automated processes
- [x] TUI support: user-friendly terminal menu for interactive use
- [x] Automatic reboot after applying settings (optional)

---

## Installation

***InitCraft*** requires no third-party libraries — it is entirely written using Python 3.10.x standard libraries. This makes it especially convenient for use on "clean" servers where `git`, `pip`, etc., are not yet installed.

### Installation steps:

1. **Download the project directly from GitHub**  
   (if `git` is not yet installed, use `wget`):
   ```bash
   wget https://github.com/bit-trade/InitCraft/archive/refs/heads/main.zip
   unzip main.zip
   cd InitCraft-main
   ```

2. **Ensure Python 3.10+ is installed**
   ```bash
   python3 --version
   ```
   If Python is not installed — install it (example for Ubuntu/Debian):
   ```bash
   sudo apt update
   sudo apt install python3.10
   ```

3. **Ready to run**
   ```bash
   python3 initcraft
   ```

### If you prefer using `git`:

```bash
sudo apt install git
git clone https://github.com/bit-trade/InitCraft.git
cd InitCraft
```

---

## Launch

> ⚠️ **Warning:** *InitCraft* must be run with `root` privileges because it modifies system files: `hosts`, `hostname`, `sshd_config`, `nftables.conf`, `fstab`, etc.

Before running, make sure you have carefully reviewed the contents of the `env.json` configuration file, especially if it has been edited manually. Errors in this file can lead to system configuration damage.

### Standard Launch (Interactive Mode)

```bash
sudo python3 initcraft
```

If no arguments are provided, the TUI menu will launch — a user-friendly text interface where you can choose one of the following options:
- Load a configuration map
- Generate a new configuration map
- Specify your own configuration file
- Manually enter a list of system config files

### Launch with Arguments (CLI Mode)

If launch arguments are provided (`--mode`, `--config`, `--apply`, etc.), *InitCraft* switches to CLI mode:

```bash
sudo python3 initcraft --mode 3 --config /home/admin/file.json --apply --reboot
```

To view all available flags, use the `-h` argument:

```bash
python3 initcraft -h
```

### How to Create an `env.json` File

If you're creating the `env.json` file manually, make sure it is correctly formatted.
Minimum valid content:

```json
{
  "config_files": []
}
```

The `config_files` key is required, even if currently empty. It is essential for many of *InitCraft*'s internal features.

### How to Format Key Values Properly

Since the configuration map operates on text-based system files, JSON values may contain special characters:
- `\n` — newline
- `\t` — tabulation

Example of a properly converted `hosts` file:

```json
{
  "/etc/hosts": [
    "# Generated by FORin\n",
    "127.0.0.1\tlocalhost localhost.localdomain\n",
    "::1\tlocalhost ip6-localhost ip6-loopback\n",
    "121.212.123.231\tserver.example.com server\n"
  ]
}
```

> ❗ Do not remove `\n` and `\t` — they are required to preserve the structure of config files when writing.

It is recommended to use the TUI mode or the built-in generation (`--mode 2`) to minimize errors.

---

## Examples

Below are typical usage examples of *InitCraft* in **CLI mode** — when the utility is controlled via command-line arguments.

> ⚠️ All commands must be executed with `root` privileges, as the utility interacts with system configuration files.

### Generate an initial JSON configuration map

```bash
sudo python3 initcraft --mode 2
```

What happens:
- A file `env.json` will be created in the project root (if not present);
- The file will contain a key `config_files` with an empty list as its value;
- This mode is used to create a "clean template" configuration map, which can later be filled manually or via interactive mode.

### Fill the configuration map using system config files (inline mode)

```bash
sudo python3 initcraft -m 4 --config "/etc/hosts /etc/hostname /etc/ssh/sshd_config"
```

What happens:
- The provided system config paths will be saved under the `config_files` key inside `env.json`;
- If `env.json` does not exist — it will be created;
- The utility does not modify the system files, it only builds a configuration map based on their content.

### Create backups of configuration files

```bash
sudo python3 initcraft -b --config "/etc/hosts /etc/hostname /etc/ssh/sshd_config"
```

What happens:
- Backups of the specified files will be created;
- The backups are stored in the `backup/` directory with filenames following the `<filename>.<timestamp>.bak` pattern;
- The operation is logged and printed to the console.

### Convert text-based configuration files to JSON

```bash
sudo python3 initcraft --convert true --config /etc/hostname,/etc/fstab,/etc/nftables.conf
```

What happens:
- Each file is read line by line;
- A `.json` file is created for each, storing lines as array items;
- All generated JSON files are saved in the `converted/` directory.

> 🛈 Useful for inspecting or comparing system config contents in structured JSON format.

### Apply changes and reboot the system

```bash
sudo python3 initcraft -m 1 --apply --reboot
```

What happens:
- The existing `env.json` file with the `config_files` key is loaded;
- Each listed file is edited according to the map;
- Backups are created before making changes;
- The system is rebooted after applying changes (if `--reboot` is passed).

> ⚠️ It is highly recommended to double-check the contents of `env.json` before running this command.

### Apply settings from a custom configuration map

```bash
sudo python3 initcraft -m 3 -a --config /home/admin/file_name.json
```

What happens:
- A user-provided configuration file `file_name.json` is loaded;
- All settings are applied and the listed config files are modified;
- All actions are logged and backup is performed.

### Roll back config files from latest backups

```bash
sudo python3 initcraft --rollback --config "/etc/fstab, /etc/nftables.conf, /etc/ssh/sshd_config"
```

What happens:
- The utility searches for the most recent `.bak` file in the `backup/` directory and its subdirectories;
- The latest backup is restored to its original location;
- If errors occur — warnings are printed but the process continues for remaining files.

> 🛠 Useful to undo changes after a failed or incorrect configuration update.

---

## Project Structure

Below is the structure of the `InitCraft` project with explanations for key files and directories:

```
InitCraft/
├── app.py
├── initcraft
├── constant.py
├── env.json
├── utils/
│   ├── backup.py
│   ├── cli_mode.py
│   ├── converter.py
│   ├── editor.py
│   ├── menu_print.py
│   ├── os_worker.py
│   └── tui_mode.py
├── backup/
├── converted/
├── InitCraft.log
├── README.md
├── README.en.md
└── README.ru.md
```

### 🔧 Root Files

- **`app.py`**  
  Main entry point of the utility. Checks for root privileges and initiates either TUI or CLI mode depending on the arguments.  
  Essentially acts as the shell and dispatcher of core logic.

- **`initcraft`**  
  Symbolic link that allows `InitCraft` to be launched as a utility without `.py` extension.  
  Can be added to `$PATH` for system-wide use.

- **`env.json`**  
  Primary configuration map file. Stores the list of config files to edit and their new content.  
  Has a strict structure and is used in `default`, `file`, and `inline` modes.

- **`constant.py`**  
  Contains global variables: utility name, version, loggers, TUI color schemes, messages, and menu templates.  
  Centralizes common settings.

- **`InitCraft.log`**  
  Log file where all utility actions are recorded: file creation/application/restore, errors, warnings, and debug messages.

### 📁 Directories

- **`backup/`**  
  Directory for storing configuration file backups.  
  File names follow the pattern `<filename>.<timestamp>.bak`.  
  Supports subdirectories if files are from different locations.

- **`converted/`**  
  Directory where JSON files are saved after converting from original text-based configs (e.g. `/etc/hosts`).  
  Used by the `txt_to_json()` function.

### 🧩 `utils/` Module

- **`backup.py`**  
  Contains functions for creating and restoring configuration backups.  
  Used manually via CLI and automatically before applying settings.

- **`cli_mode.py`**  
  Handles command-line arguments (via `argparse`).  
  Defines execution mode (`--mode`), config path, flags `--apply`, `--convert`, `--reboot`, `--rollback`, and more.

- **`converter.py`**  
  Contains the `txt_to_json()` function for line-by-line parsing of text configs into structured JSON format.  
  Allows generating configuration maps from existing files.

- **`editor.py`**  
  Core module with the `ConfigMaker` class.  
  Implements logic for loading, editing, applying configs, validating the map, and integrating with other modules.  
  Manages modes: `default`, `generate`, `file`, `inline`.

- **`menu_print.py`**  
  Helper module for user interaction via terminal in IDE environments.

- **`os_worker.py`**  
  Contains classes and functions for interacting with the OS, including reboot and system command execution.  
  Requires root privileges.

- **`tui_mode.py`**  
  Implements TUI interface using the `curses` library.  
  Allows the user to interactively select modes, load and apply config maps.

### 🗂 Other Files

- **`README.md`**  
  The main documentation for the project, in Russian.

- **`README.en.md`**  
  An alternative language version of the project description.

---

## Requirements

`InitCraft` is designed with simplicity and full autonomy in mind. The utility does not require any third-party libraries or frameworks — it relies solely on Python's standard libraries.

### Minimum Requirements:

- **Python** version **3.10** (or compatible)
- **Root access** to the target server (VPS or physical machine)
- **Terminal access**:
  - via **SSH** (remote connection)
  - or through **physical console** (monitor, keyboard, USB access, etc.)

### No additional dependencies required.

The utility is ready to work immediately after being copied to the server, even if `git` is not yet installed.

---

## Author

**Igor Mironenko** — systems engineer and Python developer focused on DevOps and server automation.

GitHub: [bit-trade](https://github.com/bit-trade)  
Telegram: [@F0Rin](https://t.me/F0Rin)

---
